<!-- https://www.amocrm.ru/developers/content/crm_platform/webhooks-api -->

# Оглавление

Вебхуки

В данном разделе описывается работа с вебхуками через API.  
Информация про формат получаемых хуков доступна [тут](/developers/content/crm_platform/webhooks-format)

*   [Общая информация](#common-info)
    
*   [Список установленных вебхуков в аккаунте](#webhooks-list)
    
*   [Подписка на вебхук](#webhook-subscribe)
    
*   [Отписка от событий](#webhooks-delete)
    
*   [Возможные события](#webhooks-available-actions)
    

### Общая информация

*   В одном аккаунте может быть не более 100 хуков
*   Один вебхук может быть подписан на несколько событий

### Список установленных вебхуков в аккаунте

#### Метод

_GET /api/v4/webhooks_

#### Описание

Метод позволяет получить список установленных вебхуков в аккаунте.

#### Ограничения

Метод доступен с правами администратора аккаунта.

#### GET параметры

| Параметр | Тип данных | Описание |
| --- | --- | --- |
| filter | object | Фильтр |
| filter\[destination\] | string | Фильтр по точному адресу вебхука |

#### Заголовок типа данных при успешном результате

_Content-Type: application/hal+json_

#### Заголовок типа данных при ошибке

_Content-Type: application/problem+json_

#### HTTP коды ответа

| Код ответа | Условие |
| --- | --- |
| 200 | Запрос выполнен успешно |
| 401 | Пользователь не авторизован |

#### Параметры ответа

Метод возвращает коллекцию моделей вебхуков, рассмотрим ниже свойства модели.

| Параметр | Тип данных | Описание |
| --- | --- | --- |
| id | int | ID вебхука |
| created\_by | int | ID пользователя, создавшего вебхук |
| created\_at | int | Дата создания вебхука, передается в Unix Timestamp |
| updated\_at | int | Дата изменения вебхука, передается в Unix Timestamp |
| sort | int | Сортировка вебхука |
| disabled | bool | Отключен ли вебхук |
| destination | string | Валидный URL на который необходимо присылать уведомления |
| settings | array | Действия, на которые подписан вебхук. Список доступных действий смотрите [тут](#webhooks-available-actions) |

#### Пример ответа

    {
        "_total_items": 2,
        "_embedded": {
            "webhooks": [
                {
                    "id": 839656,
                    "destination": "https://webhook-uri.com",
                    "created_at": 1575539157,
                    "updated_at": 1575539157,
                    "account_id": 321321,
                    "created_by": 123123,
                    "sort": 1,
                    "disabled": false,
                    "settings": [
                        "add_task"
                    ]
                },
                {
                    "id": 849193,
                    "destination": "https://api.test.ru/amoWebHook",
                    "created_at": 1576157524,
                    "updated_at": 1585816857,
                    "account_id": 321321,
                    "created_by": 123123,
                    "sort": 2,
                    "disabled": true,
                    "settings": [
                        "update_lead"
                    ]
                }
            ]
        }
    }

### Подписка на вебхук

#### Метод

_POST /api/v4/webhooks_

#### Описание

Метод позволяет подписываться на события, информация о которым придет на указанный адрес.

#### Ограничения

Метод доступен с правами администратора аккаунта.

#### Заголовок запроса

_Content-Type: application/json_

#### Параметры запроса

Для подписки на события необходимо передать обязательные параметры destination и settings. Если в аккаунте уже есть вебхук с переданным адресом, то он будет обновлен с переданными настройками.

| Параметр | Тип данных | Описание |
| --- | --- | --- |
| destination | string | Валидный URL на который необходимо присылать уведомления |
| settings | array | Действия, на которые подписан вебхук. Передается в виде массива cо списком возможных действий. Список доступных действий смотрите [тут](#webhooks-available-actions) |

#### Пример запроса

    {
        "destination": "https://example.test",
        "settings": [
            "add_lead"
        ],
        "sort": 10
    }

#### Заголовок типа данных при успешном результате

_Content-Type: application/hal+json_

#### Заголовок типа данных при ошибке

_Content-Type: application/problem+json_

#### HTTP коды ответа

| Код ответа | Условие |
| --- | --- |
| 201 | Задачи были успешно созданы |
| 422 | Переданные данные не могут быть обработаны. Подробности доступны в теле ответа |
| 401 | Пользователь не авторизован |
| 400 | Переданы некорректные данные. Подробности доступны в теле ответа |

#### Параметры ответа

Метод возвращает объект вебхука, который были созданы. Свойства аналогичны тем, что приходят в методе получения списка.

#### Пример ответа

    {
        "id": 1056949,
        "destination": "https://example.test",
        "created_at": 1589012268,
        "updated_at": 1589012268,
        "account_id": 321321,
        "created_by": 3944275,
        "sort": 1,
        "disabled": false,
        "settings": [
            "add_lead"
        ]
    }

### Отписка от событий

#### Метод

_DELETE /api/v4/webhooks_

#### Описание

Метод позволяет отписать вебхук от получения любых событий.

#### Ограничения

Метод доступен только с правами администратора аккаунта.

#### Заголовок запроса

_Content-Type: application/json_

#### Параметры запроса

Для отмены подписки на события необходимо передать обязательный параметр destination.

| Параметр | Тип данных | Описание |
| --- | --- | --- |
| destination | string | Точный адрес вебхука, который необходимо удалить из списка |

#### Пример запроса

    {
        "destination": "https://example.test"
    }

#### HTTP коды ответа

| Код ответа | Условие |
| --- | --- |
| 204 | Вебхук был успешно удален |
| 404 | Вебхук не найден |
| 403 | Не хватает прав для вызова данного метода |
| 401 | Пользователь не авторизован |
| 400 | Переданы некорректные данные. Подробности доступны в теле ответа |

#### Параметры ответа

Метод не возвращает тело

### Возможные события

| Название события | Описание |
| --- | --- |
| responsible\_lead | У сделки сменился ответственный |
| responsible\_contact | У контакта сменился ответственный |
| responsible\_company | У компании сменился ответственный |
| responsible\_customer | У покупателя сменился ответственный |
| responsible\_task | У задачи сменился ответственный |
| restore\_lead | Сделка восстановлена из удаленных |
| restore\_contact | Контакт восстановлен из удаленных |
| restore\_company | Компания восстановлена из удаленных |
| add\_lead | Добавлена сделка |
| add\_contact | Добавлен контакт |
| add\_company | Добавлена компания |
| add\_customer | Добавлен покупатель |
| add\_talk | Добавлена беседа |
| add\_task | Добавлена задача |
| update\_lead | Сделка изменена |
| update\_contact | Контакт изменён |
| update\_company | Компания изменена |
| update\_customer | Покупатель изменен |
| update\_talk | Беседа изменена |
| update\_task | Задача изменена |
| delete\_lead | Удалена сделка |
| delete\_contact | Удалён контакт |
| delete\_company | Удалена компания |
| delete\_customer | Удален покупатель |
| delete\_task | Удалена задача |
| status\_lead | У сделки сменился статус |
| note\_lead | Примечание добавлено в сделку |
| note\_contact | Примечание добавлено в контакт |
| note\_company | Примечание добавлено в компанию |
| note\_customer | Примечание добавлено в покупателя |
| add\_chat\_template\_review | Шаблон WhatsApp отправлен на одобрение |